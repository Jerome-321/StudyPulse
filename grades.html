                    // Add event listener for photo URL input
                    document.getElementById('photoUrl').addEventListener('change', function() {
                        const url = this.value.trim();
                        if (url) {
                            // Validate URL format
                            if (/^https?:\/\/.+\..+/.test(url)) {
                                document.getElementById('profilePreview').src = url;
                            } else {
                                showToast('Please enter a valid image URL', true);
                            }
                        }
                    });

                    // Add form validation for profile form
                    document.getElementById('profileForm').addEventListener('submit', function(e) {
                        const email = document.getElementById('email').value;
                        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                            e.preventDefault();
                            showToast('Please enter a valid email address', true);
                            return;
                        }
                    });

                    // Add password visibility toggle
                    const passwordInputs = document.querySelectorAll('input[type="password"]');
                    passwordInputs.forEach(input => {
                        const toggle = document.createElement('span');
                        toggle.className = 'password-toggle material-icons-sharp';
                        toggle.textContent = 'visibility';
                        toggle.style.cursor = 'pointer';
                        toggle.style.marginLeft = '-30px';
                        toggle.style.position = 'relative';
                        toggle.style.zIndex = '1';
                        toggle.addEventListener('click', function() {
                            if (input.type === 'password') {
                                input.type = 'text';
                                toggle.textContent = 'visibility_off';
                            } else {
                                input.type = 'password';
                                toggle.textContent = 'visibility';
                            }
                        });
                        input.parentNode.insertBefore(toggle, input.nextSibling);
                    });

                    // Add course grade validation
                    function validateGradeInput(input) {
                        const value = parseFloat(input.value);
                        if (isNaN(value) || value < 0 || value > 100) {
                            input.style.borderColor = 'var(--color-danger)';
                            return false;
                        } else {
                            input.style.borderColor = '';
                            return true;
                        }
                    }

                    // Add event listeners for grade validation
                    document.addEventListener('input', function(e) {
                        if (e.target.type === 'number' && 
                            (e.target.placeholder === 'Prelim' || 
                             e.target.placeholder === 'Midterm' || 
                             e.target.placeholder === 'Final')) {
                            validateGradeInput(e.target);
                        }
                    });

                    // Add course sorting functionality
                    function sortCourses(criteria) {
                        const courses = JSON.parse(localStorage.getItem("courses")) || [];
                        if (criteria === 'name') {
                            courses.sort((a, b) => a.name.localeCompare(b.name));
                        } else if (criteria === 'percentage') {
                            courses.sort((a, b) => b.percentage - a.percentage);
                        }
                        localStorage.setItem("courses", JSON.stringify(courses));
                        displaySavedCourses();
                    }

                    // Add sort buttons to saved courses container
                    const savedCoursesContainer = document.getElementById('saved-courses-container');
                    const sortButtons = document.createElement('div');
                    sortButtons.className = 'sort-buttons';
                    sortButtons.style.marginBottom = '1rem';
                    sortButtons.innerHTML = `
                        <button onclick="sortCourses('name')" class="sort-btn">
                            <span class="material-icons-sharp">sort_by_alpha</span> Sort by Name
                        </button>
                        <button onclick="sortCourses('percentage')" class="sort-btn">
                            <span class="material-icons-sharp">sort</span> Sort by Percentage
                        </button>
                    `;
                    savedCoursesContainer.insertBefore(sortButtons, savedCoursesContainer.firstChild.nextSibling);

                    // Add course statistics
                    function calculateCourseStats() {
                        const courses = JSON.parse(localStorage.getItem("courses")) || [];
                        if (courses.length === 0) return null;
                        
                        const percentages = courses.map(c => c.percentage);
                        const average = Math.round(percentages.reduce((a, b) => a + b, 0) / percentages.length);
                        const min = Math.min(...percentages);
                        const max = Math.max(...percentages);
                        
                        return { average, min, max, count: courses.length };
                    }

                    function displayCourseStats() {
                        const stats = calculateCourseStats();
                        if (!stats) return;
                        
                        const statsContainer = document.createElement('div');
                        statsContainer.className = 'course-stats';
                        statsContainer.style.display = 'flex';
                        statsContainer.style.justifyContent = 'space-between';
                        statsContainer.style.marginBottom = '1rem';
                        statsContainer.style.padding = '1rem';
                        statsContainer.style.background = 'var(--color-light)';
                        statsContainer.style.borderRadius = 'var(--border-radius-1)';
                        
                        statsContainer.innerHTML = `
                            <div>
                                <small class="text-muted">Courses</small>
                                <h3>${stats.count}</h3>
                            </div>
                            <div>
                                <small class="text-muted">Average</small>
                                <h3>${stats.average}%</h3>
                            </div>
                            <div>
                                <small class="text-muted">Highest</small>
                                <h3>${stats.max}%</h3>
                            </div>
                            <div>
                                <small class="text-muted">Lowest</small>
                                <h3>${stats.min}%</h3>
                            </div>
                        `;
                        
                        const savedCoursesDiv = document.getElementById('saved-courses');
                        savedCoursesDiv.insertBefore(statsContainer, savedCoursesDiv.firstChild);
                    }

                    // Update displaySavedCourses to include stats
                    const originalDisplaySavedCourses = displaySavedCourses;
                    displaySavedCourses = function() {
                        originalDisplaySavedCourses();
                        displayCourseStats();
                    };

                    // Add export functionality
                    function exportCourses() {
                        const courses = JSON.parse(localStorage.getItem("courses")) || [];
                        if (courses.length === 0) {
                            showToast('No courses to export', true);
                            return;
                        }
                        
                        let csv = 'Course Name,Prelim Grade,Midterm Grade,Final Grade,Percentage\n';
                        courses.forEach(course => {
                            csv += `${course.name},${course.prelim},${course.midterm},${course.final},${course.percentage}\n`;
                        });
                        
                        const blob = new Blob([csv], { type: 'text/csv' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'my_courses.csv';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        showToast('Courses exported successfully!');
                    }

                    // Add export button
                    const exportButton = document.createElement('button');
                    exportButton.className = 'export-btn';
                    exportButton.innerHTML = `
                        <span class="material-icons-sharp">download</span> Export to CSV
                    `;
                    exportButton.onclick = exportCourses;
                    document.querySelector('.sort-buttons').appendChild(exportButton);

                    // Add import functionality
                    function importCourses(e) {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const content = e.target.result;
                                const lines = content.split('\n');
                                const headers = lines[0].split(',');
                                
                                if (headers.length < 5 || 
                                    !headers[0].includes('Course Name') || 
                                    !headers[1].includes('Prelim Grade') || 
                                    !headers[2].includes('Midterm Grade') || 
                                    !headers[3].includes('Final Grade') || 
                                    !headers[4].includes('Percentage')) {
                                    showToast('Invalid CSV format', true);
                                    return;
                                }
                                
                                const courses = [];
                                for (let i = 1; i < lines.length; i++) {
                                    if (lines[i].trim() === '') continue;
                                    
                                    const values = lines[i].split(',');
                                    if (values.length < 5) continue;
                                    
                                    courses.push({
                                        name: values[0],
                                        prelim: parseFloat(values[1]) || 0,
                                        midterm: parseFloat(values[2]) || 0,
                                        final: parseFloat(values[3]) || 0,
                                        percentage: parseFloat(values[4]) || 0
                                    });
                                }
                                
                                if (courses.length > 0) {
                                    localStorage.setItem("courses", JSON.stringify(courses));
                                    displaySavedCourses();
                                    showToast(`${courses.length} courses imported successfully!`);
                                } else {
                                    showToast('No valid courses found in file', true);
                                }
                            } catch (error) {
                                showToast('Error importing courses', true);
                                console.error(error);
                            }
                        };
                        reader.readAsText(file);
                    }

                    // Add import button
                    const importInput = document.createElement('input');
                    importInput.type = 'file';
                    importInput.accept = '.csv';
                    importInput.style.display = 'none';
                    importInput.onchange = importCourses;
                    document.body.appendChild(importInput);
                    
                    const importButton = document.createElement('button');
                    importButton.className = 'import-btn';
                    importButton.innerHTML = `
                        <span class="material-icons-sharp">upload</span> Import from CSV
                    `;
                    importButton.onclick = function() {
                        importInput.click();
                    };
                    document.querySelector('.sort-buttons').appendChild(importButton);

                    // Add responsive adjustments
                    function handleResize() {
                        if (window.innerWidth < 768) {
                            // Mobile adjustments
                            document.querySelectorAll('.course-entry, .saved-course').forEach(entry => {
                                entry.style.gridTemplateColumns = '1fr';
                                entry.style.gap = '0.5rem';
                            });
                        } else {
                            // Desktop adjustments
                            document.querySelectorAll('.course-entry, .saved-course').forEach(entry => {
                                entry.style.gridTemplateColumns = '2fr 1fr 1fr 1fr auto auto';
                                entry.style.gap = '1rem';
                            });
                        }
                    }

                    window.addEventListener('resize', handleResize);
                    handleResize(); // Initial call

                    // Add confirmation for course deletion
                    const originalDeleteCourse = deleteCourse;
                    deleteCourse = function(index) {
                        if (confirm('Are you sure you want to delete this course?')) {
                            originalDeleteCourse(index);
                        }
                    };

                    // Add keyboard shortcuts
                    document.addEventListener('keydown', function(e) {
                        if (e.ctrlKey && e.key === 'n') {
                            e.preventDefault();
                            addCourse();
                        } else if (e.ctrlKey && e.key === 's') {
                            e.preventDefault();
                            saveCourses();
                        }
                    });

                    // Add tooltips
                    function addTooltip(element, text) {
                        const tooltip = document.createElement('span');
                        tooltip.className = 'tooltip';
                        tooltip.textContent = text;
                        tooltip.style.position = 'absolute';
                        tooltip.style.backgroundColor = 'var(--color-dark)';
                        tooltip.style.color = 'var(--color-white)';
                        tooltip.style.padding = '0.3rem 0.6rem';
                        tooltip.style.borderRadius = 'var(--border-radius-1)';
                        tooltip.style.fontSize = '0.8rem';
                        tooltip.style.whiteSpace = 'nowrap';
                        tooltip.style.bottom = '100%';
                        tooltip.style.left = '50%';
                        tooltip.style.transform = 'translateX(-50%)';
                        tooltip.style.marginBottom = '0.5rem';
                        tooltip.style.opacity = '0';
                        tooltip.style.transition = 'opacity 0.2s';
                        tooltip.style.pointerEvents = 'none';
                        tooltip.style.zIndex = '1000';
                        
                        element.style.position = 'relative';
                        element.appendChild(tooltip);
                        
                        element.addEventListener('mouseenter', function() {
                            tooltip.style.opacity = '1';
                        });
                        
                        element.addEventListener('mouseleave', function() {
                            tooltip.style.opacity = '0';
                        });
                    }

                    // Add tooltips to buttons
                    document.querySelectorAll('button').forEach(button => {
                        if (button.textContent.includes('Add Course')) {
                            addTooltip(button, 'Add a new course (Ctrl+N)');
                        } else if (button.textContent.includes('Save Courses')) {
                            addTooltip(button, 'Save all courses (Ctrl+S)');
                        } else if (button.textContent.includes('Remove')) {
                            addTooltip(button, 'Delete this course');
                        } else if (button.textContent.includes('Update')) {
                            addTooltip(button, 'Save changes to this course');
                        }
                    });

                    // Add loading animation
                    function showLoading(show) {
                        const loading = document.getElementById('loading');
                        if (!loading && show) {
                            const loadingDiv = document.createElement('div');
                            loadingDiv.id = 'loading';
                            loadingDiv.style.position = 'fixed';
                            loadingDiv.style.top = '0';
                            loadingDiv.style.left = '0';
                            loadingDiv.style.width = '100%';
                            loadingDiv.style.height = '100%';
                            loadingDiv.style.backgroundColor = 'rgba(0,0,0,0.5)';
                            loadingDiv.style.display = 'flex';
                            loadingDiv.style.justifyContent = 'center';
                            loadingDiv.style.alignItems = 'center';
                            loadingDiv.style.zIndex = '9999';
                            
                            const spinner = document.createElement('div');
                            spinner.className = 'spinner';
                            spinner.style.width = '50px';
                            spinner.style.height = '50px';
                            spinner.style.border = '5px solid var(--color-light)';
                            spinner.style.borderTopColor = 'var(--color-primary)';
                            spinner.style.borderRadius = '50%';
                            spinner.style.animation = 'spin 1s linear infinite';
                            
                            loadingDiv.appendChild(spinner);
                            document.body.appendChild(loadingDiv);
                            
                            // Add spin animation
                            const style = document.createElement('style');
                            style.textContent = `
                                @keyframes spin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `;
                            document.head.appendChild(style);
                        } else if (loading && !show) {
                            loading.remove();
                        }
                    }

                    // Simulate loading for save operations
                    const originalSaveCourses = saveCourses;
                    saveCourses = function() {
                        showLoading(true);
                        setTimeout(() => {
                            originalSaveCourses();
                            showLoading(false);
                        }, 1000);
                    };

                    const originalSaveUpdatedCourses = saveUpdatedCourses;
                    saveUpdatedCourses = function() {
                        showLoading(true);
                        setTimeout(() => {
                            originalSaveUpdatedCourses();
                            showLoading(false);
                        }, 1000);
                    };

                    // Initialize with one course entry
                    if (JSON.parse(localStorage.getItem("courses")) === null || JSON.parse(localStorage.getItem("courses")).length === 0) {
                        addCourse();
                    }
                </script>
            </body>
            </html>
